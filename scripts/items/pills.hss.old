# Uses global variable 50 to store steps.

# you have to take your pills every step on map
global variable (50, steps without hrt)

global variable (4763, pill bar bg slice id)
global variable (4764, pill bar fg slice id)
global variable (4765, steps without hrt)

define constant(5, pill ui timer)

plotscript, init draw pill bar, begin,

    # timer draw pill bar
    #
    #
    pill bar bg slice id :=  createrect (100, 10, 2)
    set rect border (pill bar bg slice id, border:none)
    move slice above (pill bar bg slice id, lookup slice(sl:walkabout layer))


    pill bar fg slice id :=  createrect (100, 10, 1)
    set rect border (pill bar fg slice id, border:none)
    move slice above (pill bar fg slice id, pill bar bg slice id)

    set timer(pill ui timer, 0, 1, @draw pill bar update)
end


script, draw pill bar update, begin
    # timer to activate self
end

plotscript, hrt step, begin
    variable (take hrt every x steps)
    take hrt every x steps := 300

    if (steps without hrt == take hrt every x steps), then, begin
        variable (one less hitpoint)
        one less hitpoint := get hero stat(0, stat:HP, current stat) -- 1
        set hero stat (0, stat:HP, one less hitpoint, current stat)
    end, else, begin
        steps without hrt += 1
    end

    variable (steps left)
    steps left := take hrt every x steps -- steps without hrt
    #show value(take hrt every x steps -- steps without hrt)
    show value (steps left / take hrt every x steps * 100)

    pill bar fg slice id :=  createrect (steps left, 10, 2)
end

plotscript, take hrt, begin
    steps without hrt := 0
end
